services:
  # Single Web Service - All services run together
  - type: web
    name: tsg-logistics
    env: node
    plan: starter
    buildCommand: npm install && npm run build:all
    startCommand: npm run start:all
    envVars:
      - key: NODE_ENV
        value: production
      # Orders Service
      - key: ORDERS_PORT
        value: "4001"
      - key: ORDERS_DATABASE_URL
        sync: false
      # Vendor Service
      - key: VENDOR_PORT
        value: "4002"
      - key: VENDOR_DATABASE_URL
        sync: false
      # Wallet Service
      - key: WALLET_PORT
        value: "4003"
      - key: WALLET_DATABASE_URL
        sync: false
      # API Gateway
      - key: PORT
        value: "4000"
      - key: ORDERS_SERVICE_URL
        value: http://localhost:4001
      - key: VENDOR_SERVICE_URL
        value: http://localhost:4002
      - key: WALLET_SERVICE_URL
        value: http://localhost:4003
      - key: CORS_ORIGINS
        value: https://tsg-logistics.onrender.com
      - key: TELEMETRY_CHANNEL
        value: telemetry:gateway:events
      # Web App
      - key: NEXT_PUBLIC_GATEWAY_URL
        value: http://localhost:4000
      - key: WEB_DATABASE_URL
        sync: false
      - key: AUTH_SECRET
        generateValue: true
